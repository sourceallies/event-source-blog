# Implementation

## Shipment Handler
    The events available for shipments are Submit, Assign, Ship and Deliver. A Hapi handler is created for each type of event that can be submitted that will build a command, valdate the state of the shipment and publish the event. The event needs to be validated to protect from bad data coming from the clients, such as repeat requests or invalid user-inputted data. A few examples are that a shipment cannot be created if a shipment with that ID already exists, a shipment cannot be shipped before it is assigned, and a shipment cannot be delivered before it is shipped.
    After validating the event we need to persist it. Typically, data is saved to a database to ensure that it is safe. However, in our system we have a broad need to react to events being submitted and most databases do not have a built-in way to broadcast events to applications when records are saved (beyond a simple trigger). We send events to a persistant topic (or queue) so satisfy this need. We are using Apache Kafka because it is simple and supports strict ordering within a partition, but ActiveMQ, RabbitMQ, IBM MQ Series, AWS Kinesis, and others support this feature as well. Partitioning is needed to guarantee that two events for the same shipment are not being processed at the same time. We use the shipmentId as our partition key.
